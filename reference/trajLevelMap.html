<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Trajectory level plots in leaflet — trajLevelMap • openairmaps</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Trajectory level plots in leaflet — trajLevelMap"><meta name="description" content="This function plots back trajectories on a leaflet map. This function
requires that data are imported using the openair::importTraj() function."><meta property="og:description" content="This function plots back trajectories on a leaflet map. This function
requires that data are imported using the openair::importTraj() function."><meta property="og:image" content="https://davidcarslaw.github.io/openairmaps/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">openairmaps</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/openairmaps.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bookdown.org/david_carslaw/openair/sections/maps/maps-overview.html">Book (External)</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/davidcarslaw/openairmaps/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Trajectory level plots in <code>leaflet</code></h1>
      <small class="dont-index">Source: <a href="https://github.com/davidcarslaw/openairmaps/blob/master/R/traj_trajLevelMap.R" class="external-link"><code>R/traj_trajLevelMap.R</code></a></small>
      <div class="d-none name"><code>trajLevelMap.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function plots back trajectories on a <code>leaflet</code> map. This function
requires that data are imported using the <code><a href="https://davidcarslaw.github.io/openair/reference/importTraj.html" class="external-link">openair::importTraj()</a></code> function.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">trajLevelMap</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"lon"</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>  <span class="va">pollutant</span>,</span>
<span>  type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  smooth <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  statistic <span class="op">=</span> <span class="st">"frequency"</span>,</span>
<span>  percentile <span class="op">=</span> <span class="fl">90</span>,</span>
<span>  lon.inc <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  lat.inc <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  min.bin <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  .combine <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  sigma <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  cols <span class="op">=</span> <span class="st">"turbo"</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  tile.border <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  provider <span class="op">=</span> <span class="st">"OpenStreetMap"</span>,</span>
<span>  legend.position <span class="op">=</span> <span class="st">"topright"</span>,</span>
<span>  legend.title <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  legend.title.autotext <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  control.collapsed <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  control.position <span class="op">=</span> <span class="st">"topright"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p><em>A data frame containing a HYSPLIT trajectory, perhaps accessed
with <code><a href="https://davidcarslaw.github.io/openair/reference/importTraj.html" class="external-link">openair::importTraj()</a></code>.</em></p>
<p><strong>required</strong></p>
<p>A data frame containing HYSPLIT model outputs. If this data were not
obtained using <code><a href="https://davidcarslaw.github.io/openair/reference/importTraj.html" class="external-link">openair::importTraj()</a></code>.</p></dd>


<dt id="arg-latitude-longitude">latitude, longitude<a class="anchor" aria-label="anchor" href="#arg-latitude-longitude"></a></dt>
<dd><p><em>The decimal latitude/longitude.</em></p>
<p><em>default:</em> <code>"lat"</code> / <code>"lon"</code></p>
<p>Column names representing the decimal latitude and longitude.</p></dd>


<dt id="arg-pollutant">pollutant<a class="anchor" aria-label="anchor" href="#arg-pollutant"></a></dt>
<dd><p>Pollutant to be plotted. By default the trajectory height is
used.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p><em>A method to condition the <code>data</code> for separate plotting.</em></p>
<p><em>default:</em> <code>NULL</code></p>
<p>Used for splitting the trajectories into different groups which can be
selected between using a "layer control" menu. Passed to
<code><a href="https://davidcarslaw.github.io/openair/reference/cutData.html" class="external-link">openair::cutData()</a></code>.</p></dd>


<dt id="arg-smooth">smooth<a class="anchor" aria-label="anchor" href="#arg-smooth"></a></dt>
<dd><p>Should the trajectory surface be smoothed? Defaults to <code>FALSE</code>.
Note that, when <code>smooth = TRUE</code>, no popup information will be available.</p></dd>


<dt id="arg-statistic">statistic<a class="anchor" aria-label="anchor" href="#arg-statistic"></a></dt>
<dd><p>Statistic to use for <code><a href="https://davidcarslaw.github.io/openair/reference/trajLevel.html" class="external-link">trajLevel()</a></code>. By default, the function
will plot the trajectory frequencies (<code>statistic = "frequency"</code>). As an
alternative way of viewing trajectory frequencies, the argument <code>method = "hexbin"</code> can be used. In this case hexagonal binning of the trajectory
<em>points</em> (i.e., a point every three hours along each back trajectory).
The plot then shows the trajectory frequencies uses hexagonal binning.</p>
<p>There are also various ways of plotting concentrations.</p>
<p>It is possible to set <code>statistic = "difference"</code>. In this case trajectories
where the associated concentration is greater than <code>percentile</code> are
compared with the the full set of trajectories to understand the
differences in frequencies of the origin of air masses. The comparison is
made by comparing the percentage change in gridded frequencies. For
example, such a plot could show that the top 10\<!-- % of concentrations of PM10 -->
tend to originate from air-mass origins to the east.</p>
<p>If <code>statistic = "pscf"</code> then a Potential Source Contribution Function map
is produced. This statistic method interacts with <code>percentile</code>.</p>
<p>If <code>statistic = "cwt"</code> then concentration weighted trajectories are
plotted.</p>
<p>If <code>statistic = "sqtba"</code> then Simplified Quantitative Transport Bias
Analysis is undertaken. This statistic method interacts with <code>.combine</code> and
<code>sigma</code>.</p></dd>


<dt id="arg-percentile">percentile<a class="anchor" aria-label="anchor" href="#arg-percentile"></a></dt>
<dd><p>The percentile concentration of <code>pollutant</code> against which
the all trajectories are compared.</p></dd>


<dt id="arg-lon-inc-lat-inc">lon.inc, lat.inc<a class="anchor" aria-label="anchor" href="#arg-lon-inc-lat-inc"></a></dt>
<dd><p>The longitude and latitude intervals to be used for
binning data.</p></dd>


<dt id="arg-min-bin">min.bin<a class="anchor" aria-label="anchor" href="#arg-min-bin"></a></dt>
<dd><p>The minimum number of unique points in a grid cell. Counts
below <code>min.bin</code> are set as missing.</p></dd>


<dt id="arg--combine">.combine<a class="anchor" aria-label="anchor" href="#arg--combine"></a></dt>
<dd><p>When statistic is "SQTBA" it is possible to combine lots of
receptor locations to derive a single map. <code>.combine</code> identifies the column
that differentiates different sites (commonly a column named <code>"site"</code>).
Note that individual site maps are normalised first by dividing by their
mean value.</p></dd>


<dt id="arg-sigma">sigma<a class="anchor" aria-label="anchor" href="#arg-sigma"></a></dt>
<dd><p>For the SQTBA approach <code>sigma</code> determines the amount of back
trajectory spread based on the Gaussian plume equation. Values in the
literature suggest 5.4 km after one hour. However, testing suggests lower
values reveal source regions more effectively while not introducing too
much noise.</p></dd>


<dt id="arg-cols">cols<a class="anchor" aria-label="anchor" href="#arg-cols"></a></dt>
<dd><p>The colours used for plotting, passed to
<code><a href="https://davidcarslaw.github.io/openair/reference/openColours.html" class="external-link">openair::openColours()</a></code>. The default, <code>"turbo"</code>, is a rainbow palette with
relatively perceptually uniform colours. Read more about this palette at
<a href="https://research.google/blog/turbo-an-improved-rainbow-colormap-for-visualization/" class="external-link">https://research.google/blog/turbo-an-improved-rainbow-colormap-for-visualization/</a>.</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>Opacity of the tiles. Must be between <code>0</code> and <code>1</code>.</p></dd>


<dt id="arg-tile-border">tile.border<a class="anchor" aria-label="anchor" href="#arg-tile-border"></a></dt>
<dd><p>Colour to use for the border of binned tiles. Defaults to
<code>NA</code>, which draws no border.</p></dd>


<dt id="arg-provider">provider<a class="anchor" aria-label="anchor" href="#arg-provider"></a></dt>
<dd><p><em>The basemap to be used.</em></p>
<p><em>default:</em> <code>"OpenStreetMap"</code></p>
<p>A single <a href="https://rstudio.github.io/leaflet/reference/providers.html" class="external-link">leaflet::providers</a>. See
<a href="http://leaflet-extras.github.io/leaflet-providers/preview/" class="external-link">http://leaflet-extras.github.io/leaflet-providers/preview/</a> for a list of
all base maps that can be used.</p></dd>


<dt id="arg-legend-position">legend.position<a class="anchor" aria-label="anchor" href="#arg-legend-position"></a></dt>
<dd><p><em>Position of the shared legend.</em></p>
<p><em>default:</em> <code>"topright"</code></p>
<p>Where should the legend be placed? One of "topright", "topright",
"bottomleft" or "bottomright". Passed to the <code>position</code> argument of
<code><a href="https://rstudio.github.io/leaflet/reference/addLegend.html" class="external-link">leaflet::addLegend()</a></code>. <code>NULL</code> defaults to "topright".</p></dd>


<dt id="arg-legend-title">legend.title<a class="anchor" aria-label="anchor" href="#arg-legend-title"></a></dt>
<dd><p><em>Title of the legend.</em></p>
<p><em>default:</em> <code>NULL</code></p>
<p>By default, when <code>legend.title = NULL</code>, the function will attempt to
provide a sensible legend title based on <code>colour</code>. <code>legend.title</code> allows
users to overwrite this - for example, to include units or other contextual
information. Users may wish to use HTML tags to format the title.</p></dd>


<dt id="arg-legend-title-autotext">legend.title.autotext<a class="anchor" aria-label="anchor" href="#arg-legend-title-autotext"></a></dt>
<dd><p><em>Automatically format the title of the legend?</em></p>
<p><em>default:</em> <code>TRUE</code></p>
<p>When <code>legend.title.autotext = TRUE</code>, <code>legend.title</code> will be first run
through <code><a href="quickTextHTML.html">quickTextHTML()</a></code>.</p></dd>


<dt id="arg-control-collapsed">control.collapsed<a class="anchor" aria-label="anchor" href="#arg-control-collapsed"></a></dt>
<dd><p><em>Show the layer control as a collapsed?</em></p>
<p><em>default:</em> <code>FALSE</code></p>
<p>Should the "layer control" interface be collapsed? If <code>TRUE</code>, users will
have to hover over an icon to view the options.</p></dd>


<dt id="arg-control-position">control.position<a class="anchor" aria-label="anchor" href="#arg-control-position"></a></dt>
<dd><p><em>Position of the layer control menu</em></p>
<p><em>default:</em> <code>"topright"</code></p>
<p>Where should the "layer control" interface be placed? One of "topleft",
"topright", "bottomleft" or "bottomright". Passed to the <code>position</code>
argument of <code><a href="https://rstudio.github.io/leaflet/reference/addLayersControl.html" class="external-link">leaflet::addLayersControl()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A leaflet object.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://davidcarslaw.github.io/openair/reference/trajLevel.html" class="external-link">openair::trajLevel()</a></code></p>
<p><code><a href="trajLevelMapStatic.html">trajLevelMapStatic()</a></code> for the static <code>ggplot2</code> equivalent of
<code>trajLevelMap()</code></p>
<p>Other interactive trajectory maps:
<code><a href="trajMap.html">trajMap</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="fu">trajLevelMap</span><span class="op">(</span><span class="va">traj_data</span>, pollutant <span class="op">=</span> <span class="st">"pm2.5"</span>, statistic <span class="op">=</span> <span class="st">"pscf"</span>, min.bin <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jack Davison, David Carslaw.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

