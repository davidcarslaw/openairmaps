<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="
This function plots back trajectories on a ggplot2 map. This function
requires that data are imported using the openair::importTraj() function.
It is a ggplot2 implementation of openair::trajLevel() with many of the
same arguments, which should be more flexible for post-hoc changes."><title>Trajectory level plots in ggplot2 — trajLevelMapStatic • openairmaps</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Trajectory level plots in ggplot2 — trajLevelMapStatic"><meta property="og:description" content="
This function plots back trajectories on a ggplot2 map. This function
requires that data are imported using the openair::importTraj() function.
It is a ggplot2 implementation of openair::trajLevel() with many of the
same arguments, which should be more flexible for post-hoc changes."><meta property="og:image" content="https://davidcarslaw.github.io/openairmaps/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">openairmaps</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.0.9004</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://bookdown.org/david_carslaw/openair/sections/maps/maps-overview.html">Book (External)</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/davidcarslaw/openairmaps/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Trajectory level plots in <code>ggplot2</code></h1>
      <small class="dont-index">Source: <a href="https://github.com/davidcarslaw/openairmaps/blob/HEAD/R/traj_trajLevelMap.R" class="external-link"><code>R/traj_trajLevelMap.R</code></a></small>
      <div class="d-none name"><code>trajLevelMapStatic.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a></p>
<p>This function plots back trajectories on a <code>ggplot2</code> map. This function
requires that data are imported using the <code><a href="https://davidcarslaw.github.io/openair/reference/importTraj.html" class="external-link">openair::importTraj()</a></code> function.
It is a <code>ggplot2</code> implementation of <code><a href="https://davidcarslaw.github.io/openair/reference/trajLevel.html" class="external-link">openair::trajLevel()</a></code> with many of the
same arguments, which should be more flexible for post-hoc changes.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">trajLevelMapStatic</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"lon"</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>  <span class="va">pollutant</span>,</span>
<span>  facet <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  smooth <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  statistic <span class="op">=</span> <span class="st">"frequency"</span>,</span>
<span>  percentile <span class="op">=</span> <span class="fl">90</span>,</span>
<span>  lon.inc <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  lat.inc <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  min.bin <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  .combine <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  sigma <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  tile.border <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  xlim <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ylim <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span>,</span>
<span>  map <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  map.fill <span class="op">=</span> <span class="st">"grey85"</span>,</span>
<span>  map.colour <span class="op">=</span> <span class="st">"grey75"</span>,</span>
<span>  map.alpha <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  map.lwd <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  map.lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>Data frame, the result of importing a trajectory file using
<code><a href="https://davidcarslaw.github.io/openair/reference/importTraj.html" class="external-link">openair::importTraj()</a></code>.</p></dd>


<dt>latitude, longitude</dt>
<dd><p>The decimal latitude/longitude.</p></dd>


<dt>pollutant</dt>
<dd><p>Pollutant to be plotted. By default the trajectory height is
used.</p></dd>


<dt>facet</dt>
<dd><p>Used for splitting the trajectories into different panels.
Passed to <code><a href="https://davidcarslaw.github.io/openair/reference/cutData.html" class="external-link">openair::cutData()</a></code>.</p></dd>


<dt>smooth</dt>
<dd><p>Should the trajectory surface be smoothed? Defaults to <code>FALSE</code>.
Note that smoothing may cause the plot to render slower, so consider
setting <code>crs</code> to <code>sf::st_crs(4326)</code> or <code>NULL</code>.</p></dd>


<dt>statistic</dt>
<dd><p>Statistic to use for <code><a href="https://davidcarslaw.github.io/openair/reference/trajLevel.html" class="external-link">trajLevel()</a></code>. By default, the function
will plot the trajectory frequencies (<code>statistic = "frequency"</code>). As an
alternative way of viewing trajectory frequencies, the argument <code>method = "hexbin"</code> can be used. In this case hexagonal binning of the trajectory
<em>points</em> (i.e., a point every three hours along each back trajectory).
The plot then shows the trajectory frequencies uses hexagonal binning.</p>
<p>There are also various ways of plotting concentrations.</p>
<p>It is possible to set <code>statistic = "difference"</code>. In this case trajectories
where the associated concentration is greater than <code>percentile</code> are
compared with the the full set of trajectories to understand the
differences in frequencies of the origin of air masses. The comparison is
made by comparing the percentage change in gridded frequencies. For
example, such a plot could show that the top 10\<!-- % of concentrations of PM10 -->
tend to originate from air-mass origins to the east.</p>
<p>If <code>statistic = "pscf"</code> then a Potential Source Contribution Function map
is produced. This statistic method interacts with <code>percentile</code>.</p>
<p>If <code>statistic = "cwt"</code> then concentration weighted trajectories are
plotted.</p>
<p>If <code>statistic = "sqtba"</code> then Simplified Quantitative Transport Bias
Analysis is undertaken. This statistic method interacts with <code>.combine</code> and
<code>sigma</code>.</p></dd>


<dt>percentile</dt>
<dd><p>The percentile concentration of <code>pollutant</code> against which
the all trajectories are compared.</p></dd>


<dt>lon.inc, lat.inc</dt>
<dd><p>The longitude and latitude intervals to be used for
binning data.</p></dd>


<dt>min.bin</dt>
<dd><p>The minimum number of unique points in a grid cell. Counts
below <code>min.bin</code> are set as missing.</p></dd>


<dt>.combine</dt>
<dd><p>When statistic is "SQTBA" it is possible to combine lots of
receptor locations to derive a single map. <code>.combine</code> identifies the column
that differentiates different sites (commonly a column named <code>"site"</code>).
Note that individual site maps are normalised first by dividing by their
mean value.</p></dd>


<dt>sigma</dt>
<dd><p>For the SQTBA approach <code>sigma</code> determines the amount of back
trajectory spread based on the Gaussian plume equation. Values in the
literature suggest 5.4 km after one hour. However, testing suggests lower
values reveal source regions more effectively while not introducing too
much noise.</p></dd>


<dt>alpha</dt>
<dd><p>Opacity of the tiles. Must be between <code>0</code> and <code>1</code>.</p></dd>


<dt>tile.border</dt>
<dd><p>Colour to use for the border of binned tiles. Defaults to
<code>NA</code>, which draws no border.</p></dd>


<dt>xlim, ylim</dt>
<dd><p>The x- and y-limits of the plot. If <code>NULL</code>, limits will be
estimated based on the lat/lon ranges of the input data.</p></dd>


<dt>crs</dt>
<dd><p>The coordinate reference system (CRS) into which all data should
be projected before plotting. Defaults to latitude/longitude
(<code>sf::st_crs(4326)</code>).</p></dd>


<dt>map</dt>
<dd><p>Should a base map be drawn? Defaults to <code>TRUE</code>.</p></dd>


<dt>map.fill</dt>
<dd><p>Colour to use to fill the polygons of the base map (see
<code><a href="https://rdrr.io/r/grDevices/colors.html" class="external-link">colors()</a></code>).</p></dd>


<dt>map.colour</dt>
<dd><p>Colour to use for the polygon borders of the base map (see
<code><a href="https://rdrr.io/r/grDevices/colors.html" class="external-link">colors()</a></code>).</p></dd>


<dt>map.alpha</dt>
<dd><p>Transparency of the base map polygons. Must be between <code>0</code>
(fully transparent) and <code>1</code> (fully opaque).</p></dd>


<dt>map.lwd</dt>
<dd><p>Line width of the base map polygon borders.</p></dd>


<dt>map.lty</dt>
<dd><p>Line type of the base map polygon borders. See
<code><a href="https://ggplot2.tidyverse.org/reference/scale_linetype.html" class="external-link">ggplot2::scale_linetype()</a></code> for common examples.</p></dd>


<dt>...</dt>
<dd><p>Arguments passed on to <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">ggplot2::coord_sf</a></code></p><dl><dt><code>expand</code></dt>
<dd><p>If <code>TRUE</code>, the default, adds a small expansion factor to
the limits to ensure that data and axes don't overlap. If <code>FALSE</code>,
limits are taken exactly from the data or <code>xlim</code>/<code>ylim</code>.</p></dd>

    <dt><code>datum</code></dt>
<dd><p>CRS that provides datum to use when generating graticules.</p></dd>

    <dt><code>label_graticule</code></dt>
<dd><p>Character vector indicating which graticule lines should be labeled
where. Meridians run north-south, and the letters <code>"N"</code> and <code>"S"</code> indicate that
they should be labeled on their north or south end points, respectively.
Parallels run east-west, and the letters <code>"E"</code> and <code>"W"</code> indicate that they
should be labeled on their east or west end points, respectively. Thus,
<code>label_graticule = "SW"</code> would label meridians at their south end and parallels at
their west end, whereas <code>label_graticule = "EW"</code> would label parallels at both
ends and meridians not at all. Because meridians and parallels can in general
intersect with any side of the plot panel, for any choice of <code>label_graticule</code> labels
are not guaranteed to reside on only one particular side of the plot panel. Also,
<code>label_graticule</code> can cause labeling artifacts, in particular if a graticule line
coincides with the edge of the plot panel. In such circumstances, <code>label_axes</code> will
generally yield better results and should be used instead.</p>
<p>This parameter can be used alone or in combination with <code>label_axes</code>.</p></dd>

    <dt><code>label_axes</code></dt>
<dd><p>Character vector or named list of character values
specifying which graticule lines (meridians or parallels) should be labeled on
which side of the plot. Meridians are indicated by <code>"E"</code> (for East) and
parallels by <code>"N"</code> (for North). Default is <code>"--EN"</code>, which specifies
(clockwise from the top) no labels on the top, none on the right, meridians
on the bottom, and parallels on the left. Alternatively, this setting could have been
specified with <code>list(bottom = "E", left = "N")</code>.</p>
<p>This parameter can be used alone or in combination with <code>label_graticule</code>.</p></dd>

    <dt><code>lims_method</code></dt>
<dd><p>Method specifying how scale limits are converted into
limits on the plot region. Has no effect when <code>default_crs = NULL</code>.
For a very non-linear CRS (e.g., a perspective centered
around the North pole), the available methods yield widely differing results, and
you may want to try various options. Methods currently implemented include <code>"cross"</code>
(the default), <code>"box"</code>, <code>"orthogonal"</code>, and <code>"geometry_bbox"</code>. For method <code>"cross"</code>,
limits along one direction (e.g., longitude) are applied at the midpoint of the
other direction (e.g., latitude). This method avoids excessively large limits for
rotated coordinate systems but means that sometimes limits need to be expanded a
little further if extreme data points are to be included in the final plot region.
By contrast, for method <code>"box"</code>, a box is generated out of the limits along both directions,
and then limits in projected coordinates are chosen such that the entire box is
visible. This method can yield plot regions that are too large. Finally, method
<code>"orthogonal"</code> applies limits separately along each axis, and method
<code>"geometry_bbox"</code> ignores all limit information except the bounding boxes of any
objects in the <code>geometry</code> aesthetic.</p></dd>

    <dt><code>ndiscr</code></dt>
<dd><p>Number of segments to use for discretising graticule lines;
try increasing this number when graticules look incorrect.</p></dd>

    <dt><code>default</code></dt>
<dd><p>Is this the default coordinate system? If <code>FALSE</code> (the default),
then replacing this coordinate system with another one creates a message alerting
the user that the coordinate system is being replaced. If <code>TRUE</code>, that warning
is suppressed.</p></dd>

    <dt><code>clip</code></dt>
<dd><p>Should drawing be clipped to the extent of the plot panel? A
setting of <code>"on"</code> (the default) means yes, and a setting of <code>"off"</code>
means no. In most cases, the default of <code>"on"</code> should not be changed,
as setting <code>clip = "off"</code> can cause unexpected results. It allows
drawing of data points anywhere on the plot, including in the plot margins. If
limits are set via <code>xlim</code> and <code>ylim</code> and some data points fall outside those
limits, then those data points may show up in places such as the axes, the
legend, the plot title, or the plot margins.</p></dd>

  
</dl></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A <code>ggplot2</code> plot</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>the original <code><a href="https://davidcarslaw.github.io/openair/reference/trajLevel.html" class="external-link">openair::trajLevel()</a></code></p>
<p><code><a href="trajLevelMap.html">trajLevelMap()</a></code> for the interactive <code>leaflet</code> equivalent of
<code>trajLevelMapStatic()</code></p>
<p>Other static trajectory maps: 
<code><a href="trajMapStatic.html">trajMapStatic</a>()</code></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Jack Davison, David Carslaw.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

